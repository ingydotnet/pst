#!/usr/bin/env bash

set -e -u

export USER=user
export HOME=/home/$USER

if [[ $HOST_GID != 1000 ]]; then
  groupadd -g "$HOST_GID" "$USER"
  useradd -u "$HOST_UID" -g "$HOST_GID" "$USER"
  chown -R "$USER.$USER" "$HOME"
fi

chmod a+rwx /root

command=${*:-bash}
if [[ $command == bash ]]; then
  su --shell=/usr/bin/bash "$USER"
else
  [[ $# -gt 0 ]] || set -- bash
  su --shell=/usr/bin/bash --command="$*" "$USER"
fi
